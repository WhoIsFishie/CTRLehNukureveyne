<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Overlay Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #FF3131;
        }
        .input-section {
            margin-bottom: 30px;
            text-align: center;
        }
        .input-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .input-option {
            flex: 1;
            min-width: 300px;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            border: 2px solid #FF3131;
        }
        .input-option h4 {
            color: #FF3131;
        }
        .controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .control-group {
            flex: 1;
            min-width: 300px;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border: 2px solid #FF3131;
            text-align: center;
        }
        .control-group h3 {
            color: #FF3131;
        }
        .overlay-options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .overlay-option {
            cursor: pointer;
            border: 2px solid #ddd;
            border-radius: 5px;
            padding: 5px;
        }
        .overlay-option.selected {
            border-color: #FF3131;
            background-color: #ffecec;
        }
        .overlay-option img {
            width: 100px;
            height: 100px;
            object-fit: cover;
        }
        .preview-section {
            text-align: center;
            margin-top: 30px;
        }
        #canvas {
            width: 100%;
            max-width: 100%;
            border: 2px solid #FF3131;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button {
            background-color: #FF3131;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background-color: #e02525;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #downloadBtn {
            background-color: #FF3131;
        }
        #downloadBtn:hover {
            background-color: #e02525;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            justify-content: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #FF3131;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        input[type="text"], input[type="file"] {
            padding: 10px;
            margin: 10px;
            border: 2px solid #FF3131;
            border-radius: 5px;
            width: 200px;
        }
        .loading {
            color: #ff9800;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .note {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
        .divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #FF3131, transparent);
            margin: 20px 0;
            border: none;
        }
        .warning-box {
            background-color: #fff5f5;
            border: 2px solid #FF3131;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .warning-box h2 {
            color: #FF3131;
            text-align: center;
            margin-bottom: 15px;
        }
        .warning-box p {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        .intro {
            text-align: center;
            margin: 20px 0 30px;
            padding: 15px;
            background-color: #fff5f5;
            border: 1px solid #FF3131;
            border-radius: 5px;
        }
        .threats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .threat-item {
            background-color: #ffecec;
            border: 1px solid #FF3131;
            border-radius: 5px;
            padding: 15px;
        }
        .threat-item h3 {
            color: #FF3131;
            margin-bottom: 10px;
            text-align: center;
        }
        .action-section {
            background-color: #fff5f5;
            border: 2px solid #FF3131;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
        }
        .action-section h2 {
            color: #FF3131;
            margin-bottom: 20px;
            text-align: center;
        }
        .action-section p {
            margin-bottom: 25px;
            font-size: 1.1rem;
        }
        .instructions {
            background-color: #ffecec;
            border: 1px solid #FF3131;
            border-radius: 5px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
        }
        .instructions h3 {
            color: #FF3131;
            margin-bottom: 15px;
            text-align: center;
        }
        .instructions ol {
            padding-left: 20px;
            margin: 0;
        }
        .instructions li {
            margin-bottom: 10px;
        }
        .email-btn {
            background-color: #000;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            letter-spacing: 0.01em;
            text-transform: uppercase;
            border-radius: 5px;
        }
        .email-btn:hover {
            background-color: #333;
        }
        .hashtags {
            margin-top: 25px;
            padding: 15px;
        }
        .hashtag {
            color: #FF3131;
            margin: 0 10px;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>STOP THE MEDIA CONTROL BILL</h1>
        
        <div class="intro">
            <p>Generate a profile picture to raise awareness about the Media Control Bill threat to social media freedom in the Maldives. Download your image and use it as your profile picture on social media platforms to join the movement!</p>
        </div>
        
        <div class="warning-box">
            <h2>URGENT: This Bill Threatens Democracy</h2>
            <p>The proposed Media Control Bill would replace media self-regulation with government control, giving authorities unprecedented power to silence journalists, news outlets, social media users and content creators.</p>
            
            <div class="threats-grid">
                <div class="threat-item">
                    <h3>Crushing Financial Penalties</h3>
                    <p>Individual social media users and journalists face fines up to MVR 25,000 (US$ 1,620) for not making "corrections" fast enough</p>
                </div>
                
                <div class="threat-item">
                    <h3>Social Media Shutdowns</h3>
                    <p>Social media accounts and pages can be shut down indefinitely without formal court verdicts during "investigations"</p>
                </div>
                
                <div class="threat-item">
                    <h3>Content Raids</h3>
                    <p>"National security" clause allows the commission to raid social media accounts and content creators through police</p>
                </div>
                
                <div class="threat-item">
                    <h3>Forced Apologies</h3>
                    <p>Social media users can be forced to apologize for posting information the government deems "false"</p>
                </div>
                
                <div class="threat-item">
                    <h3>Internet Censorship</h3>
                    <p>Commission can block websites, social media platforms, and target individual social media posts and content creators</p>
                </div>
                
                <div class="threat-item">
                    <h3>Rigged Oversight</h3>
                    <p>President appoints 3 of 7 commission members, while parliament can dismiss elected media representatives</p>
                </div>
            </div>
        </div>
        
        <div class="input-section">
            <h3>Choose Image Source</h3>
            <div class="input-options">
                <div class="input-option">
                    <h4>Upload Image</h4>
                    <input type="file" id="imageUpload" accept="image/*">
                </div>
                <div class="input-option">
                    <h4>Twitter Profile Picture</h4>
                    <input type="text" id="twitterUsername" placeholder="Enter Twitter username">
                    <button id="fetchTwitterBtn">Fetch Profile Picture</button>
                    <div id="twitterStatus"></div>
                </div>
            </div>
        </div>

        <div class="divider"></div>
        
        <div class="controls">
            <div class="control-group">
                <h3>Bill Overlay</h3>
                <div class="toggle-container">
                    <span>Enable Bill Overlay:</span>
                    <label class="switch">
                        <input type="checkbox" id="billToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <p>Applies to all images</p>
                <img src="overlays/bill overlay.png" alt="Bill Overlay" style="max-width: 200px;">
            </div>
            
            <div class="control-group">
                <h3>Select Overlay</h3>
                <p>Choose one of the following overlays:</p>
                <div class="overlay-options" id="overlayOptions">
                    <!-- Overlay options will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="preview-section">
            <h3>Generate Your Profile Picture</h3>
            <canvas id="canvas"></canvas>
            <div>
                <button id="downloadBtn" disabled>Download Result</button>
            </div>
        </div>
        
        <div class="action-section">
            <h2>TAKE ACTION NOW</h2>
            <p>Use this tool to generate a profile picture that raises awareness about the Media Control Bill threat to democracy. Download your image and set it as your profile picture on social media to join the movement!</p>
            
            <div class="instructions">
                <h3>How to Help:</h3>
                <ol>
                    <li>Generate an image using the tool above</li>
                    <li>Download the result using the "Download Result" button</li>
                    <li>Set it as your profile picture on Twitter, Facebook, Instagram, and other social media platforms</li>
                    <li>Share the image on your social media timelines to spread awareness</li>
                    <li>Email the Independent Institutions Committee to reject this dangerous bill</li>
                </ol>
            </div>
            
            <button id="emailBtn" class="email-btn">Send Email to Parliament Committee</button>
            
            <div class="hashtags">
                <span class="hashtag">#UluBillOut</span>
                <span class="hashtag">#CTRLBillBeyrukurey</span>
                <span class="hashtag">#CTRLehNukureveyne</span>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const imageUpload = document.getElementById('imageUpload');
        const twitterUsername = document.getElementById('twitterUsername');
        const fetchTwitterBtn = document.getElementById('fetchTwitterBtn');
        const twitterStatus = document.getElementById('twitterStatus');
        const billToggle = document.getElementById('billToggle');
        const overlayOptions = document.getElementById('overlayOptions');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const downloadBtn = document.getElementById('downloadBtn');
        const emailBtn = document.getElementById('emailBtn');
        
        // Available overlays
        const overlays = ['overlay0.png', 'overlay1.png', 'overlay2.png'].map(f => `overlays/${f}`);
        let selectedOverlay = null;
        let currentImage = null;
        // Hardcoded API endpoint - no localStorage usage
        const apiEndpoint = 'https://twitproxy.wovencoast.me';
        
        // Initialize the overlay options
        function initOverlayOptions() {
            overlayOptions.innerHTML = '';
            overlays.forEach((overlay, index) => {
                const option = document.createElement('div');
                option.className = 'overlay-option';
                option.innerHTML = `
                    <img src="${overlay}" alt="${overlay}" crossOrigin="Anonymous">
                `;
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.overlay-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    selectedOverlay = overlay;
                    if (currentImage) {
                        renderImage();
                    }
                });
                overlayOptions.appendChild(option);
                
                // Select the first overlay by default
                if (index === 0) {
                    option.classList.add('selected');
                    selectedOverlay = overlay;
                }
            });
        }
        
        // Handle image upload
        imageUpload.addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.crossOrigin = "Anonymous"; // Enable CORS for the image
                    img.onload = function() {
                        currentImage = img;
                        renderImage();
                    }
                    img.src = event.target.result;
                }
                reader.readAsDataURL(e.target.files[0]);
            }
        });
        
        // Fetch Twitter profile picture
        fetchTwitterBtn.addEventListener('click', function() {
            const username = twitterUsername.value.trim();
            if (!username) {
                twitterStatus.textContent = 'Please enter a Twitter username';
                twitterStatus.className = 'error';
                return;
            }
            
            twitterStatus.textContent = 'Fetching profile picture...';
            twitterStatus.className = 'loading';
            
            // Use our server endpoint to fetch the Twitter profile picture
            const img = new Image();
            img.crossOrigin = "Anonymous"; // Enable CORS for the image
            img.onload = function() {
                currentImage = img;
                twitterStatus.textContent = 'Profile picture loaded successfully!';
                twitterStatus.className = 'success';
                renderImage();
            };
            img.onerror = function() {
                twitterStatus.textContent = 'Failed to load profile picture. Please check the username and ensure the server is running.';
                twitterStatus.className = 'error';
            };
            img.src = `${apiEndpoint}/twitter-avatar/${username}`;
        });
        
        // Handle bill overlay toggle
        billToggle.addEventListener('change', renderImage);
        
        // Download button event
        downloadBtn.addEventListener('click', function() {
            if (!canvas.toDataURL) return;
            const link = document.createElement('a');
            link.download = 'overlay-result.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
        
        // Email button event
        emailBtn.addEventListener('click', function() {
            const subject = encodeURIComponent('URGENT: Reject the Media Control Bill - Defend Social Media Freedom');
            
            const body = encodeURIComponent(`My name is [YOUR NAME].

I call on the Independent Institutions Committee chair Hussain Riza Adam to reject the Media Control Bill.

This bill poses a severe threat to social media freedom and democratic expression in the Maldives. The proposed legislation would:

• Allow indefinite shutdown of social media accounts without court verdicts
• Impose crushing fines on individual social media users (up to MVR 25,000)
• Enable government raids of social media accounts under "national security" pretexts
• Force social media users to apologize for posts deemed "false" by authorities
• Block websites and censor social media content and platforms
• Replace media self-regulation with government control

The vague definitions of "fake news" and "false information" are ripe for abuse and could lead to criminal prosecution of social media users simply for expressing their views.

I urge the committee to:
1. Reject this bill entirely
2. Protect constitutional social media and expression freedoms
3. Maintain the current self-regulatory framework
4. Engage in genuine consultation with digital rights stakeholders

Social media freedom is fundamental to democracy in the digital age. This bill must not pass.

#UluBillOut
#CTRLBillBeyrukurey  
#CTRLehNukureveyne

Respectfully,
[YOUR NAME]`);

            const mailtoLink = `mailto:indep.institutions_committee@majlis.gov.mv?subject=${subject}&body=${body}`;
            
            window.location.href = mailtoLink;
        });
        
        // Render the image with overlays
        function renderImage() {
            if (!currentImage) return;
            
            // Set a fixed canvas size to ensure square images and prevent layout shifts
            const canvasSize = 800;
            canvas.width = canvasSize;
            canvas.height = canvasSize;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw the base image, scaled to fit the square canvas (maintaining aspect ratio)
            const aspectRatio = currentImage.width / currentImage.height;
            let drawWidth, drawHeight, offsetX = 0, offsetY = 0;
            
            if (aspectRatio > 1) {
                // Landscape image - fit to height
                drawHeight = canvasSize;
                drawWidth = currentImage.width * (drawHeight / currentImage.height);
                offsetX = (canvasSize - drawWidth) / 2;
            } else {
                // Portrait or square image - fit to width
                drawWidth = canvasSize;
                drawHeight = currentImage.height * (drawWidth / currentImage.width);
                offsetY = (canvasSize - drawHeight) / 2;
            }
            
            ctx.drawImage(currentImage, offsetX, offsetY, drawWidth, drawHeight);
            
            // Apply the red color overlay (#FF3131) with low opacity
            ctx.fillStyle = 'rgba(255, 49, 49, 0.25)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw bill overlay if enabled
            if (billToggle.checked) {
                const billImg = new Image();
                billImg.crossOrigin = "Anonymous"; // Enable CORS for the image
                billImg.onload = function() {
                    // Set opacity for bill overlay (0.7 = 70% opacity)
                    ctx.globalAlpha = 0.7;
                    ctx.drawImage(billImg, 0, 0, canvas.width, canvas.height);
                    // Reset global alpha to default
                    ctx.globalAlpha = 1.0;
                    // Draw selected overlay if one is chosen
                    if (selectedOverlay) {
                        const overlayImg = new Image();
                        overlayImg.crossOrigin = "Anonymous"; // Enable CORS for the image
                        overlayImg.onload = function() {
                            ctx.drawImage(overlayImg, 0, 0, canvas.width, canvas.height);
                            downloadBtn.disabled = false;
                        };
                        overlayImg.src = selectedOverlay;
                    } else {
                        downloadBtn.disabled = false;
                    }
                };
                billImg.src = 'overlays/bill overlay.png';
            } else if (selectedOverlay) {
                // Draw selected overlay if bill is not enabled
                const overlayImg = new Image();
                overlayImg.crossOrigin = "Anonymous"; // Enable CORS for the image
                overlayImg.onload = function() {
                    ctx.drawImage(overlayImg, 0, 0, canvas.width, canvas.height);
                    downloadBtn.disabled = false;
                };
                overlayImg.src = selectedOverlay;
            } else {
                // No overlays selected
                downloadBtn.disabled = false;
            }
        }
        
        // Initialize the page
        window.onload = function() {
            initOverlayOptions();
            
            // Load default image
            const defaultImg = new Image();
            defaultImg.crossOrigin = "Anonymous"; // Enable CORS for the image
            defaultImg.onload = function() {
                currentImage = defaultImg;
                // Set selected overlay to the first one by default
                selectedOverlay = overlays[0];
                renderImage();
            };
            defaultImg.src = 'default.jpg';
        };
    </script>
</body>
</html>